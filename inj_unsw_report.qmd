---
title: "Injustice Attention Report"
author: "Tom Beesley"
format: html
editor_options: 
  chunk_output_type: console
---

## Setup and loading in the data

```{r}
library(tidyverse)
library(eyetools)

load("inj_unsw_data.RData")

eg_stim <- 
  eg_stim %>%
  mutate(pNum = as.numeric(pNum))
```

## Setting up AOIs 

```{r}
# Set AOIs
AOI_stims <- data.frame(matrix(nrow = 3, ncol = 4))
colnames(AOI_stims) <- c("x", "y", "width_radius", "height")

AOI_stims[1,] <- c(450, 540, 600, 600) # X, Y, W, H - left
AOI_stims[2,] <- c(1460, 540, 600, 600) # X, Y, W, H - right
AOI_stims[3,] <- c(960, 540, 200, 200) # X, Y, W, H - fixation

AOI_stims_names <- c("left", "right", "centre")
```

## Number of fixations

Here's what a typical trial looks like with 25 fixations (using `eyetools::spatial_plot()`):
```{r}
data_trial <- 
  eg_stim %>% 
  filter(pNum == 001, 
         trial == 3)

eyetools::spatial_plot(fix_data = data_trial, 
                       AOIs = AOI_stims)
```

You can see from the index numbers that there is back and forth processing between the two stimuli. We can use `eyetools::AOI_seq()` to look at how the eye movements entered the different AOIs (here, just for the first 5 trials for this participant):

```{r}

data_p1 <- 
  eg_stim %>% 
  filter(pNum == 001)

eyetools::AOI_seq(data = data_p1, AOIs = AOI_stims, AOI_names = AOI_stims_names) %>% 
  head(5)

```

Here's the distribution of number of fixations on a trial for all the data:

```{r}
eg_stim %>% 
  group_by(pNum, trial) %>% 
  summarise(nFix = n()) %>% 
  ggplot() +
  geom_histogram(aes(nFix), bins = 30, fill = "dark blue") + 
  theme_classic(base_size = 12) +
  labs(title = "Distribution of number of fixations per trial",
       x = "Number of fixations within a trial",
       y = "")
```

Do the participants vary much in the mean number of fixations per trial? There are a couple of outliers in terms of number of fixations. 

```{r}

eg_stim %>% 
  group_by(pNum, trial) %>% 
  summarise(n_fix = n()) %>% 
  group_by(pNum) %>% 
  summarise(mean_fix = mean(n_fix)) %>% 
  ggplot(aes(mean_fix, x = "")) +
  geom_violin() +
  geom_dotplot(binaxis = "y", stackdir = "center")

```

## Looking at time in AOIs for the different trial types / stimulus valence

```{r}
stim_codes <- 
  read_csv("stim_details.csv") %>% 
  rename(trial_ID = pair_num)
  

id_data <- 
  id_data %>% 
  left_join(stim_codes, by = "trial_ID")

eg_list <- split.data.frame(eg_stim, eg_stim[,1])

AOI_list <- lapply(eg_list, AOI_time, AOIs = AOI_stims)

AOI_df <- do.call(rbind.data.frame, b)

eg_data_combined <- cbind(id_data, AOI_df) # bind together the data

eg_data_combined <- eg_data_combined %>% mutate(across(AOI_1:AOI_3, ~as.numeric(.x)))

# pair type
# 1 = UNJ-NEG
# 2 = UNJ-NEUT
# 3 = NEG-NEUT

# target_loc
# 1 = LHS
# 2 = RHS

eg_data_full <- 
  eg_data_combined %>% 
  mutate(pair_type = case_match(pair_type,
                                1 ~ "unj_neg",
                                2 ~ "unj_neut",
                                3 ~ "neg_neut")) %>% 
  mutate(stim_1_eg = case_when(target_loc == 1 ~ AOI_1,
                               target_loc == 2 ~ AOI_3),
         stim_2_eg = case_when(target_loc == 1 ~ AOI_3,
                               target_loc == 2 ~ AOI_1))
```

# summarising the data for visualisation

```{r}
eg_means_summary <- 
  eg_data_full %>% 
  group_by(pNum, pair_type) %>% 
  summarise(meanS1 = mean(stim_1_eg, na.rm = TRUE),
            meanS2 = mean(stim_2_eg, na.rm = TRUE))

eg_means_summary <- 
eg_means_summary %>% 
  pivot_longer(cols = c("meanS1", "meanS2"), 
               names_prefix = "mean", 
               names_to = "stimulus", 
               values_to = "EG_time")

eg_fig <- 
  eg_means_summary %>% 
  group_by(pair_type, stimulus) %>% 
  summarise(meanEG = mean(EG_time),
            SE_EG = sd(EG_time)/sqrt(n()))

eg_fig %>% 
  ggplot(aes(x = pair_type, y = meanEG, fill = stimulus)) +
  geom_col(position = position_dodge2()) +
  geom_errorbar(aes(ymin = meanEG - SE_EG,
                    ymax = meanEG + SE_EG), 
                position = position_dodge2()) +
  coord_cartesian(ylim = c(1500, 2600)) +
  theme_classic(base_size = 12) +
  labs(y = "Mean dwell time on AOIs")
  


```




